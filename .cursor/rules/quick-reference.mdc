---
description: Critical development rules for 3D printer system with file redirection
globs: **/*
alwaysApply: true
---

## CRITICAL OPERATIONAL RULES

### Framework Integrity
- **ALWAYS verify framework files remain untouched** after any modifications
- **ALWAYS use -o `/home/pi/Downloads/curl`** when using curl
- **NEVER modify framework files directly** - always use redirection system
- **NEVER bypass the redirection system** - all customizations must go through mod-zones
- **NEVER assume framework files are safe** - always check their status

### Overlay System Overview
- **GOAL**: Enable small source-controlled area with easy removal/reinstall of foundational installation and core OS
- **METHOD**: Transparent file redirection using bind mounts and include directives
- **BENEFIT**: Framework updates don't affect customizations; only mod-zones need version control
- **EXCEPTION**: Include directives are programmatically injected into core files (e.g., `/boot/firmware/config.txt`)
- **PRINCIPLE**: Original framework files remain completely untouched except for include statements

### Overlay System Components
- **FILE OVERLAYS**: Bind mounts that transparently redirect file reads (e.g., `printer.cfg`)
- **INCLUDE DIRECTIVES**: Programmatic injection of include statements into core files
- **MOD-ZONES**: User-controlled directories containing custom modifications (`/home/pi/3dp-mods/`)
- **MANAGER SCRIPT**: `/home/pi/.user-scripts/redirector/file-overlay-manager.sh` (global command: `overlay`)
- **CONFIG FILE**: `/home/pi/.user-scripts/redirector/overlay-config.conf` (defines all mappings)
- **SYSTEMD SERVICE**: Auto-applies overlays on boot

### System File Tracking
- **GOAL**: Never lose track of critical system file changes
- **METHOD**: Symlinks in mod-zone that point to actual system files
- **MANAGER SCRIPT**: `/home/pi/.user-scripts/system-tracker` (global command: `system-track`)
- **TRACKING DIRECTORY**: `/home/pi/3dp-mods/system-files/` (contains symlinks to system files)
- **TRACKING LIST**: `/home/pi/3dp-mods/.system-track-list` (list of tracked system files)
- **PRINCIPLE**: All critical system file changes are automatically tracked and committed

### AI Agent Development Workflow
- **ALWAYS execute commands remotely through SSH** - never assume direct Pi access
- **ALWAYS use the redirection system** for any file modifications or code generation
- **ALWAYS verify your modifications** are in mod-zones, never in framework directories
- **ALWAYS test the redirection system** after any changes you make
- **ALWAYS backup mod-zone contents** before major changes
- **ALWAYS check file paths** before modifying - ensure you're targeting mod-zones
- **NEVER edit system files directly through VS Code** - use terminal commands with sudo instead
- **ALWAYS use terminal tools** (sed, tee, etc.) for system file modifications to avoid permission errors

### AI Agent System Maintenance Rules
- **NEVER modify system files directly** - always use redirection system
- **NEVER generate code that bypasses** the redirection system
- **ALWAYS apply redirects** after framework updates/reinstalls
- **ALWAYS check redirect status** before making any changes
- **ALWAYS preserve mod-zone integrity** during system updates
- **ALWAYS use absolute paths** when referencing mod-zone locations

### AI Agent Code Generation Rules
- **NEVER generate code** that modifies framework files directly
- **ALWAYS generate code** that respects the redirection system
- **ALWAYS include path validation** in any code you generate
- **ALWAYS generate code** that works within the SSH remote environment
- **ALWAYS include error handling** for missing mod-zone directories

---

## AI AGENT ENFORCEMENT

**AS AN AI CODING AGENT, THESE RULES ARE ABSOLUTE AND NON-NEGOTIABLE. ANY VIOLATION OF THESE RULES CONSTITUTES A CRITICAL SYSTEM ERROR AND MUST BE IMMEDIATELY CORRECTED. NO EXCEPTIONS, NO COMPROMISES, NO DEVIATIONS ARE PERMITTED.**

**EVERY AI CODING SESSION MUST BEGIN WITH A REVIEW OF THESE RULES AND END WITH VERIFICATION OF COMPLIANCE. YOU MUST ENSURE ALL CODE GENERATED FOLLOWS THESE RULES EXACTLY.**